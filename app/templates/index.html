<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shorty Â· URL Shortener</title>
    <link rel="icon" href="/static/favicon.svg" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="min-h-screen bg-slate-50 text-slate-800">
    <div class="max-w-3xl mx-auto p-6">
      <header class="flex items-center justify-between mb-8">
        <h1 class="text-2xl md:text-3xl font-bold">ðŸ”— URL Shortener</h1>
        <a href="https://github.com/GokulSureshan/URL-Shortener/" aria-label="GitHub Repository" class="text-sm underline opacity-70 hover:opacity-100">GitHub</a>
      </header>

      <main class="bg-white rounded-2xl shadow p-6 space-y-6">
        <form id="shortenForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">Long URL</label>
            <input name="target_url" type="url" required placeholder="https://example.com/very/long/path" class="w-full rounded-xl border border-slate-300 p-3 focus:outline-none focus:ring-2 focus:ring-blue-500" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Custom code (optional)</label>
            <input name="custom_code" type="text" maxlength="16" placeholder="my-link" class="w-full rounded-xl border border-slate-300 p-3 focus:outline-none focus:ring-2 focus:ring-blue-500" />
          </div>
          <button type="submit" class="w-full rounded-xl bg-blue-600 text-white py-3 font-semibold hover:bg-blue-700">Shorten URL</button>
        </form>

        <div id="result" class="hidden p-4 bg-green-50 border border-green-200 rounded-xl"></div>

        <section>
          <h2 class="text-lg font-semibold mb-2">Recent</h2>
          <ul class="divide-y divide-slate-200" id="recentList">
            {% for item in recent %}
              <li class="py-2 flex items-center justify-between">
                <div class="truncate">
                  <a class="text-blue-600 underline" href="/{{ item.short_code }}" target="_blank">/{{ item.short_code }}</a>
                  <span class="text-slate-500">â†’</span>
                  <span class="truncate text-slate-700">{{ item.target_url }}</span>
                </div>
                <span class="text-xs text-slate-500">{{ item.clicks }} clicks</span>
              </li>
            {% else %}
              <li class="py-2 text-slate-500">No links yet. Create one above.</li>
            {% endfor %}
          </ul>
        </section>
      </main>

      <footer class="mt-8 text-center text-xs text-slate-500">Built with FastAPI + Tailwind</footer>
    </div>

    <script>
      const form = document.getElementById('shortenForm');
      const result = document.getElementById('result');
      const recentList = document.getElementById('recentList');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = new FormData(form);
        try {
          const resp = await fetch('/shorten', { method: 'POST', body: data });
          const json = await resp.json();
          if (!resp.ok) {
            result.className = 'p-4 bg-red-50 border border-red-200 rounded-xl';
            result.textContent = json.detail || 'Error shortening URL';
            result.classList.remove('hidden');
            return;
          }
          result.className = 'p-4 bg-green-50 border border-green-200 rounded-xl';
          result.innerHTML = `Short URL: <a class="underline text-blue-700" target="_blank" href="${json.short_url}">${json.short_url}</a>`;
          result.classList.remove('hidden');

          // Prepend to recent list (best-effort UI update)
          const li = document.createElement('li');
          li.className = 'py-2 flex items-center justify-between';
          li.innerHTML = `<div class="truncate"><a class="text-blue-600 underline" href="/${json.code}" target="_blank">/${json.code}</a> <span class="text-slate-500">â†’</span> <span class="truncate text-slate-700">${data.get('target_url')}</span></div><span class="text-xs text-slate-500">0 clicks</span>`;
          recentList.prepend(li);

          form.reset();
        } catch (error) {
          result.className = 'p-4 bg-red-50 border border-red-200 rounded-xl';
          result.textContent = 'Network error. Please try again.';
          result.classList.remove('hidden');
        }
      });
    </script>
  </body>
</html>